<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Push 설정</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header d-flex align-items-center">
            <h5 class="col fw-bold mx-5">Web Push 설정</h5>
        </div>
        <div class="card card-subtitle card-size mt-5 mx-2" style="border-radius: 24px;">
            <div class="card-header bg-transparent card-title m-2">
                <span class="step text-nowrap m-2">1</span>기본 정보
            </div>
            <div class="card-body row d-flex">
                <form action="" class="setting-form col-6 mx-3" id="form1">
                    <div class="serv-nm border rounded d-flex p-0">
                        <div class="p-2 w-25">
                            <label for="serviceNm" class="fw-bold">서비스명</label>
                        </div>
                        <div class="w-100 p-1">
                            <input class="form-control" value="" type="text" name="serviceNm" id="" placeholder="기업명 혹은 서비스명을 입력해주세요.">
                        </div>
                    </div>
                    <div class="serv-nm border rounded d-flex p-0 mt-2">
                        <div class="p-2" style="width: 135px;">
                            <label for="serviceSite" class="fw-bold">사이트 URL</label>
                        </div>
                        <div class="w-100 p-1">
                            <input class="form-control" type="text" value="" name="serviceSite" id="" placeholder="기업 혹은 서비스의 사이트 URL 입력해주세요.">
                        </div>
                    </div>
                    <div class="serv-nm border rounded h-25 d-flex p-0 mt-2 align-items-center">
                        <div class="p-2" style="width: 135px;">
                            <label for="uploadIcon" class="fw-bold">아이콘</label>
                        </div>
                        <div class="w-100 d-flex flex-row-reverse align-items-center">
                            <button class="btn1 btn-blue px-3 mx-1" type="button" id="uploadBtn">업로드</button>
                            <p id="imgLink" class="mt-3 w-50"></p>
                            <!-- <input type="text" class="hidden" value="" name="uploadIcon" value="" id="iconUpload"> -->
                        </div>
                    </div>
                    <div class="mt-3 d-flex flex-row-reverse">
                        <button type="submit" class="btn1 btn-blue px-3 ">저장</button>
                    </div>
                </form>
                <div class="col col-xs-8 mt-sm-4 mt-lg-0 mx-sm-3 d-flex justify-content-lg-center justify-content-sm-start">
                        <div class="preview-bg">
                            <div class="preview-title d-flex justify-content-between pt-2 px-3">
                                <p class="text-muted" id="browserNm"><span><i class="bi bi-browser-chrome mx-1"></i></span>브라우저명</p>
                                <div>
                                    <i class="bi bi-gear-fill text-muted"></i>
                                    <i class="bi bi-x-lg text-muted"></i>
                                </div>
                            </div>
                            <div class="preview-body row">
                                <div class="col mx-4 icon mt-3 pt-4">
                                    <div class="fs-12 text-center">아이콘</div>
                                </div>
                                <div class="col">
                                    <p class="text-muted pb-0" id="serviceNm">서비스명</p>
                                    <p id="msg-content" class="text-truncate" style="max-width: 250px;">메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용메시지내용</p><span class="text-muted">더보기</span>
                                    <p id="siteUrl" class="text-muted">사이트 URL</p>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
        <div class="card card-subtitle card-size mt-5 mx-2" style="border-radius: 24px;">
            <div class="card-header bg-transparent card-title m-2">
                <span class="step text-nowrap m-2">2</span>구독 완료 메시지 & 휴대폰번호 수집 설정
            </div>
            <div class="card-body row">
                <form action="" class="setting-form col-6 mx-3" id="form2">
                    <div class="serv-nm border rounded d-flex mt-2 p-0">
                        <div class="p-2 w-25">
                            <label for="alert-msg" class="fw-bold">내용</label>
                        </div>
                        <div class="w-100 p-1">
                            <input class="form-control" type="text" name="alertMsg1" id="" placeholder="알림 구독 완료! 이제 최신 소식들을 받아볼 수 있습니다.">
                        </div>
                    </div>
                    <div class="serv-nm border rounded d-flex mt-2 p-0">
                        <div class="p-2 w-25">
                            <label for="auth-phone" class="fw-bold">휴대폰번호 수집</label>
                        </div>
                        <div class="w-100 p-1">
                            <div class="form-check form-switch mx-3 mt-2 position-relative">
                               <input class="form-check-input" type="checkbox" name="phoneNumAgree" id="flexSwitchCheck" style="width: 40px;">    
                               <span class="position-absolute hidden" id="on">ON</span> 
                            </div>
                            <input class="form-control" type="text" name="alertMsg2" id="" placeholder="휴대폰번호도 등록하면 문자로 더 유익한 혜택을 보내드려요!">
                        </div>
                    </div>
                    <div class="mt-3 d-flex justify-content-end">
                        <button type="submit" class="btn1 btn-blue px-3">저장</button>
                    </div>
                </form>
                <div class="col d-flex justify-content-lg-center justify-content-sm-start m-sm-3 m-lg-2">
                    <div class="preview-bg-1 mt-sm-2 mt-lg-0 p-4">
                        <div class="preview-title">
                            <p class="fw-bold" id="alertMsg1">알림 구독 완료! 이제 최신 소식들을 받아볼 수 있습니다.</p>
                            <p class="text-muted" id="alertMsg2">휴대폰번호도 등록하면 문자로 더 유익한 혜택을 보내드려요!</p>
                        </div>
                        <div class="preview-body">
                            <div class="d-flex">
                                <input type="number" name="authPhone" class="form-control" placeholder="휴대폰번호(선택 입력)">
                                <button class="btn1 btn-blue w-50">인증번호 발송</button>
                            </div>
                        </div>
                        <div class="preview-footer mt-4 d-flex justify-content-between align-items-center">
                            <p class="fs-12 text-muted">지메시 이용중</p>
                            <button class="btn border text-purple fw-bold">취소</button>
                        </div>
                    </div>
                </div>        
            </div>
        </div>
        <div class="card card-subtitle card-size mt-5 mx-2" style="border-radius: 24px;">
            <div class="card-header bg-transparent card-title m-2">
                <span class="step text-nowrap m-2">3</span>연동하기
            </div>
            <div class="card-body">
                <div class="setting-form mx-3 w-100"> 
                    <h6>귀하의 웹사이트 &lt/body&gt 태그 바로 위에 다음 스크립트를 추가하세요.</h6>
                    <div class="card card-subtitle block-code rounded p-0 w-50 mt-3">
                        <div class="card-header bg-transparent p-0 d-flex flex-row align-items-start">
                            <div class="m-0 w-25 mx-2 position-relative">
                                <svg style="max-width: 15px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="javascript"><path fill="#F0D91F" d="M0 0h24v24H0z"></path><path d="M19.784 18.629c-.255-.961-2.251-1.185-3.616-2.205-1.38-.93-1.709-3.18-.569-4.471.39-.48 1.034-.84 1.71-1.005l.705-.089c1.365-.031 2.204.329 2.834 1.034.182.179.316.36.586.78-.721.449-.721.449-1.755 1.125-.226-.48-.586-.78-.976-.9-.6-.18-1.365.014-1.515.66-.059.195-.045.375.046.705.243.555 1.061.795 1.797 1.14 2.115.858 2.828 1.778 3.003 2.873l-.046-.067c.166.945-.045 1.56-.074 1.65-.781 2.67-5.131 2.76-6.871 1.004-.36-.42-.6-.629-.81-1.109l1.83-1.051c.495.75.944 1.156 1.755 1.336 1.096.135 2.206-.24 1.966-1.41zm-11.651.347c.017 0 .064.091.127.196.233.389.434.659.83.855.386.121 1.236.209 1.566-.48.201-.348.138-1.479.138-2.711 0-1.941.009-3.867.009-5.805h2.248l-.004.056c0 2.07.012 4.125 0 6.179.005 1.276.113 2.416-.397 3.346-.353.72-1.028 1.185-1.811 1.411-1.203.27-2.352.105-3.207-.405-.574-.345-1.019-.887-1.324-1.517l1.825-1.125z"></path></svg>
                                <p class="fw-bold position-absolute" style="margin:-22px 20px;color: #ffff;">JS</p>
                            </div>
                            <button class="btn p-0 copy-btn w-100 d-flex justify-content-end align-items-center" disabled>
                                <span class="text-muted">|</span><i class="bi bi-clipboard mx-1"></i>
                            </button>
                        </div>
                        <div class="card-body">
                            <p class="hidden" id="jsCodeTxt">&ltscript src="https://cdn.gimesee.com/WebSDK.js" charset="UTF-8"&gt&lt/script&gt<br>
                               &ltscript&gt<br>
                               Gimesee.initialize({ projectId: "990by8d93-2f7f-43an-bd78-c0323b194eb1" });
                               &lt/script&gt
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>              
    </div>
    <Script>
        $(document).ready(function(){
            // params: serviceNm, serviceSite, uploadIcon
            $('#form1').on('submit', function(e){
                e.defaultPrevented();
                const data = $("#form1").serialize();
                submitFormTo($(this).attr('action'), data);
            });

            // params: pushTitle, pushContent, followBtnNm, closeBtnNm, popShowTime, popShowDate
            $('#form2').on('submit', function(e){
                e.defaultPrevented();
                const data = $("#form2").serialize();
                submitFormTo($(this).attr('action'), data);
            });

            
            
            $('#form1 button').click(function(){
                localStorage.setItem("chk", 1);
            });
            $('#form2 button').click(function(){
                localStorage.setItem("chk", 2);
            });
            
            if(localStorage.getItem("chk") == 2){
                localStorage.removeItem("chk");
                $('#jsCodeTxt').removeClass("hidden");
                $('.copy-btn').prop('disabled', false);
            }

            $('#flexSwitchCheck').change(function(){
                $(this).is(':checked') == true ? $(this).val('Y') : $(this).val('N');
            });

            $('input[name="serviceNm"]').change(function(){
                $('#serviceNm').text($(this).val());
            });
            $('input[name="serviceSite"]').change(function(){
                $('#siteUrl').text($(this).val());
            });
            $('#uploadBtn').click(function(){
                $('.preview-body .icon').children().remove();
                $('.preview-body .icon').css("background-image","url('https://picsum.photos/75/75')");
                $('#imgLink').text("https://picsum.photos/75/75");
            });

            $('input[name="alertMsg1"]').change(function(){
                $('#alertMsg1').text($(this).val());
            });

            $('input[name="alertMsg2"]').change(function(){
                $('#alertMsg2').text($(this).val());
            });
            $('#flexSwitchCheck').hover(function(){
                $(this).css("cursor", "pointer");
            });



            $('#iconDel').click(function(){
        $('#thumbImg').attr('src', '');
    });


    $('input[name="colorPk"]').change(function(){
        $(this).next().html($(this).val());
    });

    let cnt = 0;
    $('#flexSwitchCheck').click(function(){
        cnt +=1;
        if(cnt%2 == 0){
            $(this).css('background-color', 'gray');  
            $(this).next().addClass('hidden');  
        }else{
            $(this).css('background-color', 'green');
            $(this).next().removeClass('hidden');  
        }
    });

    $('.bi-clipboard').click(function(){
        copyToClipboard('#jsCodeTxt');
        $(this).removeClass('bi-clipboard');
        $(this).addClass('bi-clipboard-check');
    });

    const copyToClipboard= (el) =>{
        let $temp = $("<input>");
        $("body").append($temp);
        $temp.val($(el).text()).select();
        document.execCommand("copy");
        $temp.remove();
    }


        }); 

        const submitFormTo = (url, data) =>{
            $.ajax({
                url: url,
                method: "POST",
                data: data,
                dataType: "json",
                processData: false,
                contentType: false,
                cache: false,
                success: function(){
                    alert('Success');
                }, 
                error: function(){
                   alert('post form error!'); 
                }
            });
        }
    </Script>
</body>
</html>